generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["public"]
}

model User {
  id                          String     @id @db.Uuid
  displayName                 String?
  createdAt                   DateTime   @default(now())
  updatedAt                   DateTime
  aud                         String?    @db.VarChar(255)
  banned_until                DateTime?  @db.Timestamptz(6)
  confirmation_sent_at        DateTime?  @db.Timestamptz(6)
  confirmation_token          String?    @db.VarChar(255)
  confirmed_at                DateTime?  @db.Timestamptz(6)
  deleted_at                  DateTime?  @db.Timestamptz(6)
  email                       String?    @db.VarChar(255)
  email_change                String?    @db.VarChar(255)
  email_change_confirm_status Int?       @default(0) @db.SmallInt
  email_change_sent_at        DateTime?  @db.Timestamptz(6)
  email_change_token_current  String?    @default("") @db.VarChar(255)
  email_change_token_new      String?    @db.VarChar(255)
  email_confirmed_at          DateTime?  @db.Timestamptz(6)
  encrypted_password          String?    @db.VarChar(255)
  instance_id                 String?    @db.Uuid
  invited_at                  DateTime?  @db.Timestamptz(6)
  is_anonymous                Boolean    @default(false)
  is_sso_user                 Boolean    @default(false)
  is_super_admin              Boolean?
  last_sign_in_at             DateTime?  @db.Timestamptz(6)
  phone                       String?    @unique
  phone_change                String?    @default("")
  phone_change_sent_at        DateTime?  @db.Timestamptz(6)
  phone_change_token          String?    @default("") @db.VarChar(255)
  phone_confirmed_at          DateTime?  @db.Timestamptz(6)
  raw_app_meta_data           Json?
  raw_user_meta_data          Json?
  reauthentication_sent_at    DateTime?  @db.Timestamptz(6)
  reauthentication_token      String?    @default("") @db.VarChar(255)
  recovery_sent_at            DateTime?  @db.Timestamptz(6)
  recovery_token              String?    @db.VarChar(255)
  role                        String?    @db.VarChar(255)
  UserRole                    UserRole[]

  @@schema("public")
}

model UserRole {
  id        Int       @id @default(autoincrement())
  userId    String    @db.Uuid
  roleId    Int
  createdAt DateTime  @default(now())
  createdBy String?   @db.Uuid
  Role      AdminRole @relation(fields: [roleId], references: [id])
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([roleId])
  @@index([userId])
  @@schema("public")
}

model AdminRole {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  description String?
  adminGrade  AdminGrade @default(STAFF)
  level       Int        @default(0)
  permissions Json?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  UserRole    UserRole[]

  @@schema("public")
}

enum AdminGrade {
  STAFF
  SUPER_ADMIN

  @@schema("public")
}
